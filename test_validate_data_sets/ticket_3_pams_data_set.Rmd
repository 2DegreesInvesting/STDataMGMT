---
title: "ticket 3 - validate the pams dataset"
output: github_document
date: "2022-09-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libaries, echo=FALSE, message=FALSE}
library(readr)
library(readxl)
library(dplyr)
```

```{r load packages, echo=FALSE, message=FALSE}
devtools::load_all()
```

```{r import data sets, echo=FALSE}
X2022_02_17_AR_2021Q4_2DII_PAMS_Data <- read_excel("~/Documents/DATA/2022-02-17_AR_2021Q4_2DII-PAMS-Data.xlsx",sheet = "Company Indicators")

Access_Bank_2022_04_07_AR_2021Q4_Free_Dataset_PACTA_for_Banks_Equity_Ownership_Consolidation <- read_excel("~/Documents/DATA/Access_Bank_2022-04-07_AR_2021Q4_Free Dataset-PACTA for Banks-Equity Ownership Consolidation.xlsx",sheet = "Company Indicators - PACTA Comp")

```


```{r filter for company_ids, echo= FALSE}
banks_company_id <- Access_Bank_2022_04_07_AR_2021Q4_Free_Dataset_PACTA_for_Banks_Equity_Ownership_Consolidation$company_id %>% unique()
original_pams_id <- X2022_02_17_AR_2021Q4_2DII_PAMS_Data$`Company ID`%>% unique()

original_vs_banks <- banks_company_id[!(banks_company_id %in% original_pams_id)]

```

## task 1: validate that company_id in banks is also part of pams 

```{r company_ids that are not in pams but banks}
original_vs_banks
```

*result: there is a list of company_id that are in banks but not in pams (85 obs found)*


## task 2: validate the processed pams data

```{r import stress test dataset, echo=TRUE, results='asis'}

abcd_stress_test_input <- read_csv("~/Documents/DATA/abcd_stress_test_input.csv")

```


### 2.1. Check for missings values 


```{r check for missings, echo=TRUE, error=TRUE}
report_missings(abcd_stress_test_input, "abcd_stress_test_input.csv", throw_error = TRUE)
```

*result: all missings are for plan_emission_factor*

```{r lets investigate where the missings are, echo=FALSE}
missings_table <- abcd_stress_test_input[rowSums(is.na(abcd_stress_test_input)) >0, ]
```


```{r count different outcomes per column, echo=FALSE}
#all missings have the same ald_sector in common 
sapply(missings_table, n_distinct)

```


```{r table the sector, echo = FALSE}
## this sector is HDV 
table(missings_table$ald_sector)
```

*result: all missings have the same ald_sector in common, i.e. HDV*


### 2.2. Check for duplicates 

```{r check for duplicates, echo=TRUE}

report_duplicates(abcd_stress_test_input, c("id", "company_name", "scenario_geography", "year", "ald_sector", "technology"), throw_error = TRUE)
```

*result: does not throw error - no duplicates found*

## task 3: How many rows are gained by using processed pams compared to banks 

```{r}
dim(Access_Bank_2022_04_07_AR_2021Q4_Free_Dataset_PACTA_for_Banks_Equity_Ownership_Consolidation)
```
```{r}
dim(abcd_stress_test_input)
```

*result: 5152106 observation in addition; or should we compare to PACTA ?*
